# Find clang
#
# This module defines
#  clang_INCLUDE_DIRS
#  clang_LIBRARIES
#  clang_FOUND
#  LLVM_CONFIG

set(clang_INSTALL_DIR ${PROJECT_SOURCE_DIR}/Dependencies/llvm CACHE PATH "")
set(clang_INCLUDE_SEARCH_DIRS "${clang_INSTALL_DIR}/include")
set(clang_LIBRARY_SEARCH_DIRS "${clang_INSTALL_DIR}/lib")
set(clang_BINARY_SEARCH_DIRS "${clang_INSTALL_DIR}/bin")

message(STATUS "Looking for Clang & LLVM installation...")
find_path(clang_INCLUDE_DIR llvm/Pass.h PATHS "${clang_INCLUDE_SEARCH_DIRS}")

mark_as_advanced(clang_INCLUDE_DIR)

if(clang_INCLUDE_DIR)
	set(clang_FOUND TRUE)
else()
	message(FATAL_ERROR "Clang/LLVM dependency: Cannot find include files.")
endif()

MACRO(FIND_AND_ADD_CLANG_LIB _libname_)
find_library(CLANG_${_libname_}_LIB ${_libname_} ${clang_LIBRARY_SEARCH_DIRS})
mark_as_advanced(CLANG_${_libname_}_LIB)

if (CLANG_${_libname_}_LIB)
	add_library(${_libname_} STATIC IMPORTED)
	set_target_properties(${_libname_} PROPERTIES IMPORTED_LOCATION ${CLANG_${_libname_}_LIB})
	
	list(APPEND clang_LIBRARY_LIST ${_libname_})
else()
	message(FATAL_ERROR "Clang/LLVM dependency: Cannot find library '${_libname_}'.")
	set(clang_FOUND FALSE)
endif()
ENDMACRO(FIND_AND_ADD_CLANG_LIB)

find_program(LLVM_CONFIG_PATH llvm-config ${clang_BINARY_SEARCH_DIRS})
mark_as_advanced(LLVM_CONFIG_PATH)

if (LLVM_CONFIG_PATH)
	set(LLVM_CONFIG ${LLVM_CONFIG_PATH})
else()
	message(FATAL_ERROR "Clang/LLVM dependency: Cannot find llvm-config.")
	set(clang_FOUND FALSE)
endif()

# Clang libraries must be specified before LLVM (order matters)
## Not all of these may be required but there is no llvm-config for clang to easily determine which ones are
FIND_AND_ADD_CLANG_LIB(clangTooling)
FIND_AND_ADD_CLANG_LIB(clangFrontendTool)
FIND_AND_ADD_CLANG_LIB(clangFrontend)
FIND_AND_ADD_CLANG_LIB(clangDriver)
FIND_AND_ADD_CLANG_LIB(clangSerialization)
FIND_AND_ADD_CLANG_LIB(clangCodeGen)
FIND_AND_ADD_CLANG_LIB(clangParse)
FIND_AND_ADD_CLANG_LIB(clangSema)
FIND_AND_ADD_CLANG_LIB(clangStaticAnalyzerFrontend)
FIND_AND_ADD_CLANG_LIB(clangStaticAnalyzerCheckers)
FIND_AND_ADD_CLANG_LIB(clangStaticAnalyzerCore)
FIND_AND_ADD_CLANG_LIB(clangAnalysis)
FIND_AND_ADD_CLANG_LIB(clangARCMigrate)
FIND_AND_ADD_CLANG_LIB(clangRewrite)
FIND_AND_ADD_CLANG_LIB(clangRewriteFrontend)
FIND_AND_ADD_CLANG_LIB(clangEdit)
FIND_AND_ADD_CLANG_LIB(clangAST)
FIND_AND_ADD_CLANG_LIB(clangLex)
FIND_AND_ADD_CLANG_LIB(clangBasic)
FIND_AND_ADD_CLANG_LIB(clangASTMatchers)
FIND_AND_ADD_CLANG_LIB(clangDynamicASTMatchers)
FIND_AND_ADD_CLANG_LIB(clangFormat)
FIND_AND_ADD_CLANG_LIB(clangIndex)
FIND_AND_ADD_CLANG_LIB(clangToolingCore)
FIND_AND_ADD_CLANG_LIB(clangToolingRefactor)

# LLVM libraries
## These are output by "llvm-config --libs" command
FIND_AND_ADD_CLANG_LIB(LLVMLTO)
FIND_AND_ADD_CLANG_LIB(LLVMPasses)
FIND_AND_ADD_CLANG_LIB(LLVMObjCARCOpts)
FIND_AND_ADD_CLANG_LIB(LLVMSymbolize)
FIND_AND_ADD_CLANG_LIB(LLVMDebugInfoPDB)
FIND_AND_ADD_CLANG_LIB(LLVMDebugInfoDWARF)
FIND_AND_ADD_CLANG_LIB(LLVMMIRParser)
FIND_AND_ADD_CLANG_LIB(LLVMCoverage)
FIND_AND_ADD_CLANG_LIB(LLVMTableGen)
FIND_AND_ADD_CLANG_LIB(LLVMDlltoolDriver)
FIND_AND_ADD_CLANG_LIB(LLVMOrcJIT)
FIND_AND_ADD_CLANG_LIB(LLVMXCoreDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMXCoreCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMXCoreDesc)
FIND_AND_ADD_CLANG_LIB(LLVMXCoreInfo)
FIND_AND_ADD_CLANG_LIB(LLVMXCoreAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMSystemZDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMSystemZCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMSystemZAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMSystemZDesc)
FIND_AND_ADD_CLANG_LIB(LLVMSystemZInfo)
FIND_AND_ADD_CLANG_LIB(LLVMSystemZAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMSparcDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMSparcCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMSparcAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMSparcDesc)
FIND_AND_ADD_CLANG_LIB(LLVMSparcInfo)
FIND_AND_ADD_CLANG_LIB(LLVMSparcAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMPowerPCDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMPowerPCCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMPowerPCAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMPowerPCDesc)
FIND_AND_ADD_CLANG_LIB(LLVMPowerPCInfo)
FIND_AND_ADD_CLANG_LIB(LLVMPowerPCAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMNVPTXCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMNVPTXDesc)
FIND_AND_ADD_CLANG_LIB(LLVMNVPTXInfo)
FIND_AND_ADD_CLANG_LIB(LLVMNVPTXAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMMSP430CodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMMSP430Desc)
FIND_AND_ADD_CLANG_LIB(LLVMMSP430Info)
FIND_AND_ADD_CLANG_LIB(LLVMMSP430AsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMMipsDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMMipsCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMMipsAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMMipsDesc)
FIND_AND_ADD_CLANG_LIB(LLVMMipsInfo)
FIND_AND_ADD_CLANG_LIB(LLVMMipsAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMLanaiDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMLanaiCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMLanaiAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMLanaiDesc)
FIND_AND_ADD_CLANG_LIB(LLVMLanaiAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMLanaiInfo)
FIND_AND_ADD_CLANG_LIB(LLVMHexagonDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMHexagonCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMHexagonAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMHexagonDesc)
FIND_AND_ADD_CLANG_LIB(LLVMHexagonInfo)
FIND_AND_ADD_CLANG_LIB(LLVMBPFDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMBPFCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMBPFDesc)
FIND_AND_ADD_CLANG_LIB(LLVMBPFInfo)
FIND_AND_ADD_CLANG_LIB(LLVMBPFAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMARMDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMARMCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMARMAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMARMDesc)
FIND_AND_ADD_CLANG_LIB(LLVMARMInfo)
FIND_AND_ADD_CLANG_LIB(LLVMARMAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMAMDGPUDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMAMDGPUCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMAMDGPUAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMAMDGPUDesc)
FIND_AND_ADD_CLANG_LIB(LLVMAMDGPUInfo)
FIND_AND_ADD_CLANG_LIB(LLVMAMDGPUAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMAMDGPUUtils)
FIND_AND_ADD_CLANG_LIB(LLVMAArch64Disassembler)
FIND_AND_ADD_CLANG_LIB(LLVMAArch64CodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMAArch64AsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMAArch64Desc)
FIND_AND_ADD_CLANG_LIB(LLVMAArch64Info)
FIND_AND_ADD_CLANG_LIB(LLVMAArch64AsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMAArch64Utils)
FIND_AND_ADD_CLANG_LIB(LLVMObjectYAML)
FIND_AND_ADD_CLANG_LIB(LLVMLibDriver)
FIND_AND_ADD_CLANG_LIB(LLVMOption)
FIND_AND_ADD_CLANG_LIB(LLVMX86Disassembler)
FIND_AND_ADD_CLANG_LIB(LLVMX86AsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMX86CodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMGlobalISel)
FIND_AND_ADD_CLANG_LIB(LLVMSelectionDAG)
FIND_AND_ADD_CLANG_LIB(LLVMAsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMDebugInfoCodeView)
FIND_AND_ADD_CLANG_LIB(LLVMDebugInfoMSF)
FIND_AND_ADD_CLANG_LIB(LLVMX86Desc)
FIND_AND_ADD_CLANG_LIB(LLVMMCDisassembler)
FIND_AND_ADD_CLANG_LIB(LLVMX86Info)
FIND_AND_ADD_CLANG_LIB(LLVMX86AsmPrinter)
FIND_AND_ADD_CLANG_LIB(LLVMX86Utils)
FIND_AND_ADD_CLANG_LIB(LLVMMCJIT)
FIND_AND_ADD_CLANG_LIB(LLVMLineEditor)
FIND_AND_ADD_CLANG_LIB(LLVMInterpreter)
FIND_AND_ADD_CLANG_LIB(LLVMExecutionEngine)
FIND_AND_ADD_CLANG_LIB(LLVMRuntimeDyld)
FIND_AND_ADD_CLANG_LIB(LLVMCodeGen)
FIND_AND_ADD_CLANG_LIB(LLVMTarget)
FIND_AND_ADD_CLANG_LIB(LLVMCoroutines)
FIND_AND_ADD_CLANG_LIB(LLVMipo)
FIND_AND_ADD_CLANG_LIB(LLVMInstrumentation)
FIND_AND_ADD_CLANG_LIB(LLVMVectorize)
FIND_AND_ADD_CLANG_LIB(LLVMScalarOpts)
FIND_AND_ADD_CLANG_LIB(LLVMLinker)
FIND_AND_ADD_CLANG_LIB(LLVMIRReader)
FIND_AND_ADD_CLANG_LIB(LLVMAsmParser)
FIND_AND_ADD_CLANG_LIB(LLVMInstCombine)
FIND_AND_ADD_CLANG_LIB(LLVMTransformUtils)
FIND_AND_ADD_CLANG_LIB(LLVMBitWriter)
FIND_AND_ADD_CLANG_LIB(LLVMAnalysis)
FIND_AND_ADD_CLANG_LIB(LLVMProfileData)
FIND_AND_ADD_CLANG_LIB(LLVMObject)
FIND_AND_ADD_CLANG_LIB(LLVMMCParser)
FIND_AND_ADD_CLANG_LIB(LLVMMC)
FIND_AND_ADD_CLANG_LIB(LLVMBitReader)
FIND_AND_ADD_CLANG_LIB(LLVMCore)
FIND_AND_ADD_CLANG_LIB(LLVMBinaryFormat)
FIND_AND_ADD_CLANG_LIB(LLVMSupport)
FIND_AND_ADD_CLANG_LIB(LLVMDemangle)

if(clang_FOUND)
	set(clang_INCLUDE_DIRS ${clang_INCLUDE_DIR})
	set(clang_LIBRARIES ${clang_LIBRARY_LIST})

	message(STATUS "...Clang OK.")
endif()
